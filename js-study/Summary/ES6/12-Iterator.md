# Iterator: 迭代器

迭代器是一种接口, 为各种不同的数据结构提供统一的访问机制. 任何数据结构只要部署Iterator接口, 就可以完成遍历操作. Iterator的作用有三个: 一是为各种数据结构, 提供一个统一的、简便的访问接口; 二是使得数据结构的成员能够按某种次序排列; 三是用于命令for...of循环, Iterator接口主要供for...of消费. 

## Iterator的遍历过程是这样的

1. 创建一个指针对象, 指向当前数据结构的起始位置. 遍历器对象本质上, 就是一个指针对象. 
2. 第一次调用指针对象的next方法, 可以将指针指向数据结构的第一个成员. 
3. 第二次调用指针对象的next方法, 指针就指向数据结构的第二个成员. 
4. 不断调用指针对象的next方法，直到它指向数据结构的结束位置.

## 可迭代协议
可迭代协议允许JavaScript对象去定义或定制它们的迭代行为, 在一个 for..of 结构中什么值可以被循环. 一些内置类型都是内置的可迭代类型并且有默认的迭代行为, 比如Array和Set以及Map, 另一些类型则不是(比如Object). 一个对象要想变成可迭代对象, 必须实现 @@iterator 方法, 也就是这个对象(或者它原型链上的某个对象)必须有一个名字是 Symbol.iterator 的属性. 

### Symbol.iterator 
如果一个对象成为一个可迭代对象, 那么该对象的Symbol.iterator属性必须返回一个对象的无参函数, 并且被返回对象符合迭代器协议. 当一个对象需要被迭代的时候(比如开始用于一个for..of循环中), 它的@@iterator方法被调用并且无参数, 然后返回一个用于在迭代中获得值的迭代器. 

## 迭代器协议

该迭代器协议定义了一种标准的方式来产生一个有限或无限序列的值, 并且当所有的值都已经被迭代后, 就会有一个默认的返回值. 当一个对象被认为是迭代器对象, 那么它必须实现了一个next()的方法并且拥有以下含义:
1. 返回一个对象的无参函数
2. 被返回对象拥有两个属性: done和value
  * done: 一个布尔值. true表示迭代器已经超过了可迭代次数, 这种情况下, value的值可以被省略; 如果迭代器可以产生序列中的下一个值, 则为false. 这等效于没有指定done这个属性. 
  * value: 迭代器返回的任何JavaScript值. done为true时可省略.

next方法必须要返回一个对象, 并且该对象有两个必要的属性:done和value, 如果返回一个非对象值会抛出一个TypeError的错误. 不可能知道一个特定的对象是否实现了迭代器协议, 然而创造一个同时满足迭代器协议和可迭代协议的对象是很容易的, 这样做允许一个迭代器能被不同希望迭代的语法方式所使用. 因此, 很少只实现迭代器协议而不实现可迭代协议. 

## 实现Itrator接口的内置对象

* Array
* Map
* Set
* String
* TypedArray
* 函数的 arguments 对象
* NodeList 对象

## 调用Iterator接口的场合

某些语句本质上就是调用Iterator接口来完成指定的功能, 具体的如下
* for...of
* 对数组和Set解构赋值
* 扩展运算符
* yield *表达式
* Array.from()
* Map(), Set(), WeakMap(), WeakSet()
* Promise.all()
* Promise.race()